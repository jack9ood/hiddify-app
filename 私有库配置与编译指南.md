# ç§æœ‰åº“é…ç½®ä¸ç¼–è¯‘æŒ‡å—

æœ¬æ–‡æ¡£åŒ…å«ç§æœ‰åº“é…ç½®ã€AAR ç¼–è¯‘å’Œ Flutter æ„å»ºçš„å®Œæ•´æŒ‡å—ã€‚

---

## ğŸ“‹ ç›®å½•

1. [ç§æœ‰åº“é…ç½®](#ç§æœ‰åº“é…ç½®)
2. [ç¼–è¯‘ Android AAR](#ç¼–è¯‘-android-aar)
3. [ç¼–è¯‘ iOS Framework](#ç¼–è¯‘-ios-framework)
4. [macOS æ ¸å¿ƒåº“](#macos-æ ¸å¿ƒåº“)
5. [Flutter æ„å»ºè¯´æ˜](#flutter-æ„å»ºè¯´æ˜)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
7. [å¿«é€Ÿå‚è€ƒ](#å¿«é€Ÿå‚è€ƒ)

---

## ç§æœ‰åº“é…ç½®

### âœ… å½“å‰é…ç½®

**å·²é…ç½®çš„ç§æœ‰åº“**ï¼š
- ä»“åº“ï¼š`github.com/jack9ood/hiddify-sing-box`
- ç‰ˆæœ¬ï¼š`v0.0.0-20251205055715-35fc725b73c1`
- é…ç½®ä½ç½®ï¼š`libcore/go.mod`

**é…ç½®å†…å®¹**ï¼š
```go
replace github.com/sagernet/sing-box => github.com/jack9ood/hiddify-sing-box v0.0.0-20251205055715-35fc725b73c1
```

### æ›´æ–°ç§æœ‰åº“

å¦‚æœä½ çš„ç§æœ‰åº“æœ‰æ–°çš„ commitï¼š

```bash
# âš ï¸ é‡è¦ï¼šå¿…é¡»åœ¨ libcore ç›®å½•ä¸‹æ‰§è¡Œ
cd libcore

# æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
go get github.com/jack9ood/hiddify-sing-box@main

# æ•´ç†ä¾èµ–
go mod tidy

# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ..

# é‡æ–°ç¼–è¯‘ AAR
make build-android-libs
```

### éªŒè¯é…ç½®

```bash
cd libcore
go list -m github.com/jack9ood/hiddify-sing-box
```

åº”è¯¥æ˜¾ç¤ºï¼š
```
github.com/jack9ood/hiddify-sing-box v0.0.0-20251205055715-35fc725b73c1
```

### æƒé™é…ç½®

å¦‚æœé‡åˆ° GitHub ç§æœ‰åº“è®¿é—®æƒé™é—®é¢˜ï¼š

```bash
# ä½¿ç”¨ Personal Access Token
git config --global url."https://YOUR_TOKEN@github.com/".insteadOf "https://github.com/"

# æˆ–ä½¿ç”¨ SSHï¼ˆæ¨èï¼‰
git config --global url."git@github.com:".insteadOf "https://github.com/"
```

---

## ç¼–è¯‘ Android AAR

### ç¼–è¯‘å‘½ä»¤

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
cd /Users/oulei/Desktop/src/hiddify-app

# ç¼–è¯‘ Android åº“ï¼ˆä½¿ç”¨ä½ çš„ç§æœ‰åº“ï¼‰
make build-android-libs

# éªŒè¯ AAR æ–‡ä»¶
ls -lh android/app/libs/hiddify-core.aar
```

### ç¼–è¯‘è¯´æ˜

- **ç¼–è¯‘ä½ç½®**ï¼š`libcore/` ç›®å½•
- **è¾“å‡ºä½ç½®**ï¼š`android/app/libs/hiddify-core.aar`
- **ä½¿ç”¨åº“**ï¼š`github.com/jack9ood/hiddify-sing-box`ï¼ˆä½ çš„ç§æœ‰åº“ï¼‰
- **ç¼–è¯‘æ—¶é—´**ï¼šé€šå¸¸éœ€è¦ 5-15 åˆ†é’Ÿï¼Œå–å†³äºæœºå™¨æ€§èƒ½

### ç¼–è¯‘æµç¨‹

1. **å®‰è£… gomobile å·¥å…·**
   ```bash
   GOTOOLCHAIN=go1.22.3 go install github.com/sagernet/gomobile/cmd/gomobile@v0.1.1
   GOTOOLCHAIN=go1.22.3 go install github.com/sagernet/gomobile/cmd/gobind@v0.1.1
   ```

2. **ç¼–è¯‘ Android AAR**
   ```bash
   gomobile bind -v -androidapi=21 -javapkg=io.nekohasekai \
     -libname=box -tags=with_gvisor,with_quic,with_wireguard,with_ech,with_utls,with_clash_api,with_grpc \
     -trimpath -target=android \
     -o libcore/bin/libcore.aar \
     github.com/sagernet/sing-box/experimental/libbox ./mobile
   ```

3. **ç§»åŠ¨åˆ°ç›®æ ‡ç›®å½•**
   ```bash
   mv libcore/bin/libcore.aar android/app/libs/hiddify-core.aar
   ```

### é‡æ–°ç¼–è¯‘

å¦‚æœéœ€è¦é‡æ–°ç¼–è¯‘ï¼š

```bash
# æ¸…ç†ä¹‹å‰çš„æ„å»ºï¼ˆå¯é€‰ï¼‰
rm -f android/app/libs/hiddify-core.aar
rm -rf libcore/bin/*

# é‡æ–°ç¼–è¯‘
make build-android-libs
```

---

## ç¼–è¯‘ iOS Framework

### ç¼–è¯‘å‘½ä»¤

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
cd /Users/oulei/Desktop/src/hiddify-app

# ç¼–è¯‘ iOS åº“ï¼ˆLibcore.xcframeworkï¼‰
make build-ios-libs

# éªŒè¯ Framework æ–‡ä»¶
ls -lh ios/Frameworks/Libcore.xcframework
```

### ç¼–è¯‘è¯´æ˜

- **ç¼–è¯‘ä½ç½®**ï¼š`libcore/` ç›®å½•
- **è¾“å‡ºä½ç½®**ï¼š`ios/Frameworks/Libcore.xcframework`
- **ä½¿ç”¨åº“**ï¼š`github.com/jack9ood/hiddify-sing-box`ï¼ˆä½ çš„ç§æœ‰åº“ï¼‰
- **ç¼–è¯‘æ—¶é—´**ï¼šé€šå¸¸éœ€è¦ 5-15 åˆ†é’Ÿï¼Œå–å†³äºæœºå™¨æ€§èƒ½
- **å¿…éœ€å·¥å…·**ï¼šXcodeã€gomobileã€gobind

### ç¼–è¯‘æµç¨‹

1. **å®‰è£… gomobile å·¥å…·**
   ```bash
   GOTOOLCHAIN=go1.22.3 go install github.com/sagernet/gomobile/cmd/gomobile@v0.1.1
   GOTOOLCHAIN=go1.22.3 go install github.com/sagernet/gomobile/cmd/gobind@v0.1.1
   ```

2. **åˆå§‹åŒ– gomobile**
   ```bash
   export PATH="$(go env GOPATH)/bin:$PATH"
   gomobile init
   ```

3. **ç¼–è¯‘ iOS Framework**
   ```bash
   # åœ¨ libcore ç›®å½•ä¸‹
   cd libcore
   export PATH="$(go env GOPATH)/bin:$PATH"
   make ios
   ```

4. **ç§»åŠ¨åˆ°ç›®æ ‡ç›®å½•**
   ```bash
   # åœ¨é¡¹ç›®æ ¹ç›®å½•
   mv libcore/bin/Libcore.xcframework ios/Frameworks/Libcore.xcframework
   ```

### ç¼–è¯‘æ ‡ç­¾

iOS ç¼–è¯‘ä½¿ç”¨é¢å¤–çš„æ ‡ç­¾ï¼ˆåœ¨ `libcore/Makefile` ä¸­å®šä¹‰ï¼‰ï¼š

```makefile
TAGS=with_gvisor,with_quic,with_wireguard,with_ech,with_utls,with_clash_api,with_grpc
IOS_ADD_TAGS=with_dhcp,with_low_memory,with_conntrack
```

### é‡æ–°ç¼–è¯‘

å¦‚æœéœ€è¦é‡æ–°ç¼–è¯‘ï¼š

```bash
# æ¸…ç†ä¹‹å‰çš„æ„å»ºï¼ˆå¯é€‰ï¼‰
rm -rf ios/Frameworks/Libcore.xcframework
rm -rf libcore/bin/*

# é‡æ–°ç¼–è¯‘
make build-ios-libs
```

### âš ï¸ é‡è¦æç¤º

- **Xcode å¿…éœ€**ï¼šç¼–è¯‘ iOS Framework éœ€è¦å®Œæ•´çš„ Xcode å®‰è£…ï¼Œä¸èƒ½åªå®‰è£… Command Line Tools
- **gomobile è·¯å¾„**ï¼šç¡®ä¿ `libcore/Makefile` ä¸­ä½¿ç”¨å®Œæ•´è·¯å¾„è°ƒç”¨ gomobile
- **PATH ç¯å¢ƒå˜é‡**ï¼šç¼–è¯‘æ—¶ç¡®ä¿ `$(go env GOPATH)/bin` åœ¨ PATH ä¸­

---

## macOS æ ¸å¿ƒåº“

### è¯´æ˜

macOS åº”ç”¨ä½¿ç”¨é¢„ç¼–è¯‘çš„æ ¸å¿ƒåº“ï¼Œä¸éœ€è¦ä» Go æºç ç¼–è¯‘ã€‚æ ¸å¿ƒåº“æ–‡ä»¶ä» GitHub Releases ä¸‹è½½ã€‚

### ä¸‹è½½æ ¸å¿ƒåº“

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
make macos-libs
```

è¿™ä¼šï¼š
- ä» GitHub Releases ä¸‹è½½ `hiddify-core-macos-universal.tar.gz`
- è§£å‹åˆ° `libcore/bin/` ç›®å½•

### ä¸‹è½½è¯´æ˜

- **ä¸‹è½½ä½ç½®**ï¼š`libcore/bin/`
- **åº“ç‰ˆæœ¬**ï¼šç”± `dependencies.properties` ä¸­çš„ `core.version` å†³å®š
- **ä¸‹è½½æ¸ é“**ï¼šæ ¹æ® `CHANNEL` ç¯å¢ƒå˜é‡é€‰æ‹©ï¼š
  - `CHANNEL=prod`ï¼šä»æ­£å¼ç‰ˆæœ¬ä¸‹è½½
  - å…¶ä»–ï¼šä» draft ç‰ˆæœ¬ä¸‹è½½

### éªŒè¯åº“æ–‡ä»¶

```bash
# æ£€æŸ¥åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh libcore/bin/libcore.dylib

# å¦‚æœæ–‡ä»¶å­˜åœ¨ â†’ å¯ä»¥ç›´æ¥æ„å»º Flutter
# å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ â†’ éœ€è¦å…ˆæ‰§è¡Œ make macos-libs
```

### é‡æ–°ä¸‹è½½

å¦‚æœéœ€è¦é‡æ–°ä¸‹è½½ï¼š

```bash
# æ¸…ç†ä¹‹å‰çš„åº“æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
rm -rf libcore/bin/*

# é‡æ–°ä¸‹è½½
make macos-libs
```

### âš ï¸ é‡è¦æç¤º

- **ä¸éœ€è¦ç¼–è¯‘**ï¼šmacOS æ ¸å¿ƒåº“æ˜¯é¢„ç¼–è¯‘çš„ï¼Œä¸éœ€è¦ä½¿ç”¨ gomobile ç¼–è¯‘
- **è‡ªåŠ¨ä¸‹è½½**ï¼š`make macos-prepare` ä¼šè‡ªåŠ¨ä¸‹è½½æ ¸å¿ƒåº“
- **ç‰ˆæœ¬ç®¡ç†**ï¼šç¡®ä¿ `dependencies.properties` ä¸­çš„ç‰ˆæœ¬å·æ­£ç¡®

---

## Flutter æ„å»ºè¯´æ˜

### âš ï¸ é‡è¦ï¼šFlutter ä¸ä¼šè‡ªåŠ¨ç¼–è¯‘åº•å±‚åº“

**å…³é”®ç‚¹**ï¼š
- `flutter build apk --release` **ä¸ä¼šè‡ªåŠ¨ç¼–è¯‘ AAR**
- `flutter build ios --release` **ä¸ä¼šè‡ªåŠ¨ç¼–è¯‘ Framework**
- `flutter build macos --release` **ä¸ä¼šè‡ªåŠ¨ä¸‹è½½æ ¸å¿ƒåº“**
- Flutter åªä¼šä½¿ç”¨å·²å­˜åœ¨çš„åº“æ–‡ä»¶
- å¦‚æœåº“æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ„å»ºä¼šå¤±è´¥
- `flutter clean` **ä¸ä¼šåˆ é™¤** AARã€Framework æˆ– macOS æ ¸å¿ƒåº“æ–‡ä»¶

### æ­£ç¡®çš„æ„å»ºé¡ºåº

#### Android æ„å»º

**æ–¹æ³•ä¸€ï¼šåˆ†æ­¥æ‰§è¡Œï¼ˆæ¨èï¼‰**

```bash
# 1. å…ˆç¼–è¯‘ AARï¼ˆä½¿ç”¨ä½ çš„ç§æœ‰åº“ï¼‰
make build-android-libs

# 2. å†æ„å»º Flutter APK
flutter clean
flutter build apk --release
```

**æ–¹æ³•äºŒï¼šä¸€æ¬¡æ€§æ‰§è¡Œ**

```bash
# å…ˆç¼–è¯‘ AARï¼Œå†æ„å»º APK
make build-android-libs && flutter clean && flutter build apk --release
```

#### iOS æ„å»º

**æ–¹æ³•ä¸€ï¼šåˆ†æ­¥æ‰§è¡Œï¼ˆæ¨èï¼‰**

```bash
# 1. å‡†å¤‡ iOS ç¯å¢ƒï¼ˆé¦–æ¬¡ç¼–è¯‘ï¼‰
make ios-prepare

# 2. ç¼–è¯‘ iOS Frameworkï¼ˆä½¿ç”¨ä½ çš„ç§æœ‰åº“ï¼‰
make build-ios-libs

# 3. æ„å»º iOS åº”ç”¨
flutter clean
flutter build ios --release --no-codesign
```

**æ–¹æ³•äºŒï¼šä¸€æ¬¡æ€§æ‰§è¡Œ**

```bash
# å…ˆç¼–è¯‘ Frameworkï¼Œå†æ„å»º iOS åº”ç”¨
make build-ios-libs && flutter clean && flutter build ios --release --no-codesign
```

#### macOS æ„å»º

**æ–¹æ³•ä¸€ï¼šåˆ†æ­¥æ‰§è¡Œï¼ˆæ¨èï¼‰**

```bash
# 1. å‡†å¤‡ macOS ç¯å¢ƒï¼ˆé¦–æ¬¡ç¼–è¯‘ï¼‰
make macos-prepare

# 2. å®‰è£… CocoaPods ä¾èµ–
cd macos
export LANG=en_US.UTF-8
pod install
cd ..

# 3. æ„å»º macOS åº”ç”¨
flutter clean
flutter build macos --release
```

**æ–¹æ³•äºŒï¼šä¸€æ¬¡æ€§æ‰§è¡Œ**

```bash
# å…ˆå‡†å¤‡ç¯å¢ƒï¼Œå†æ„å»º macOS åº”ç”¨
make macos-prepare && cd macos && export LANG=en_US.UTF-8 && pod install && cd .. && flutter clean && flutter build macos --release
```

### ä½•æ—¶éœ€è¦é‡æ–°ç¼–è¯‘åº•å±‚åº“ï¼Ÿ

**éœ€è¦é‡æ–°ç¼–è¯‘/ä¸‹è½½çš„æƒ…å†µ**ï¼š
- âœ… æ›´æ–°äº†ç§æœ‰åº“ï¼ˆ`go get @main`ï¼‰- Android/iOS
- âœ… ä¿®æ”¹äº† `libcore/go.mod` - Android/iOS
- âœ… ä¿®æ”¹äº† `libcore/` ä¸­çš„ Go ä»£ç  - Android/iOS
- âœ… æ›´æ–°äº† `dependencies.properties` ä¸­çš„ `core.version` - macOS
- âœ… ç¬¬ä¸€æ¬¡æ„å»ºé¡¹ç›®

**ä¸éœ€è¦é‡æ–°ç¼–è¯‘/ä¸‹è½½çš„æƒ…å†µ**ï¼š
- âœ… åªä¿®æ”¹äº† Flutter/Dart ä»£ç 
- âœ… åªä¿®æ”¹äº† Android Kotlin/Java ä»£ç 
- âœ… åªä¿®æ”¹äº† iOS Swift/Objective-C ä»£ç 
- âœ… åªä¿®æ”¹äº† macOS Swift/Objective-C ä»£ç 
- âœ… åº“æ–‡ä»¶å·²å­˜åœ¨ä¸”æœªè¿‡æœŸ

### éªŒè¯åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨

**Android**

```bash
# æ£€æŸ¥ AAR æ–‡ä»¶
ls -lh android/app/libs/hiddify-core.aar

# å¦‚æœæ–‡ä»¶å­˜åœ¨ â†’ å¯ä»¥ç›´æ¥æ„å»º Flutter
# å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ â†’ éœ€è¦å…ˆæ‰§è¡Œ make build-android-libs
```

**iOS**

```bash
# æ£€æŸ¥ Framework æ–‡ä»¶
ls -lh ios/Frameworks/Libcore.xcframework

# å¦‚æœæ–‡ä»¶å­˜åœ¨ â†’ å¯ä»¥ç›´æ¥æ„å»º Flutter
# å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ â†’ éœ€è¦å…ˆæ‰§è¡Œ make build-ios-libs
```

**macOS**

```bash
# æ£€æŸ¥æ ¸å¿ƒåº“æ–‡ä»¶
ls -lh libcore/bin/libcore.dylib

# å¦‚æœæ–‡ä»¶å­˜åœ¨ â†’ å¯ä»¥ç›´æ¥æ„å»º Flutter
# å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ â†’ éœ€è¦å…ˆæ‰§è¡Œ make macos-libs
```

---

## å¸¸è§é—®é¢˜

### 1. Go ç‰ˆæœ¬é—®é¢˜

**é”™è¯¯**ï¼š
```
invalid array length -delta * delta
```

**è§£å†³**ï¼šå·²åœ¨ Makefile ä¸­é…ç½® `GOTOOLCHAIN=go1.22.3`ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½å¹¶ä½¿ç”¨æ­£ç¡®çš„ç‰ˆæœ¬ã€‚

### 2. npm æœªå®‰è£…

**æç¤º**ï¼š
```
npm not found, skipping npm install
```

**è¯´æ˜**ï¼šè¿™æ˜¯æ­£å¸¸çš„ï¼Œnpm åªç”¨äº protobuf ç›¸å…³åŠŸèƒ½ï¼ŒAndroid ç¼–è¯‘ä¸éœ€è¦ã€‚

### 3. gomobile å‘½ä»¤æœªæ‰¾åˆ°

**é”™è¯¯**ï¼š
```
gomobile: command not found
gobind was not found. Please run gomobile init
```

**è§£å†³**ï¼š
- Androidï¼šMakefile å·²é…ç½®ä½¿ç”¨å®Œæ•´è·¯å¾„ `$(go env GOPATH)/bin/gomobile`
- iOSï¼šç¡®ä¿ `libcore/Makefile` ä¸­ä½¿ç”¨å®Œæ•´è·¯å¾„ï¼Œå¹¶åˆå§‹åŒ– gomobileï¼š
  ```bash
  export PATH="$(go env GOPATH)/bin:$PATH"
  gomobile init
  ```

### 4. ç§æœ‰åº“è®¿é—®æƒé™é—®é¢˜

å¦‚æœé‡åˆ° GitHub ç§æœ‰åº“è®¿é—®æƒé™é—®é¢˜ï¼Œå‚è€ƒä¸Šé¢çš„"æƒé™é…ç½®"éƒ¨åˆ†ã€‚

### 5. Pseudo-version é”™è¯¯

**é”™è¯¯**ï¼š
```
invalid pseudo-version: preceding tag (v1.8.8) not found
```

**åŸå› **ï¼šç§æœ‰åº“æ²¡æœ‰å¯¹åº”çš„ Git tagã€‚

**è§£å†³**ï¼šä½¿ç”¨ `go get @main` è‡ªåŠ¨è·å–æœ€æ–°ç‰ˆæœ¬ï¼ŒGo ä¼šç”ŸæˆåŸºäºå½“å‰ commit çš„ç‰ˆæœ¬å·ã€‚

### 6. iOS - Xcode æœªå®‰è£…

**é”™è¯¯**ï¼š
```
-target="ios" requires Xcode
```

**è§£å†³**ï¼š
- å®‰è£…å®Œæ•´çš„ Xcodeï¼ˆä¸èƒ½åªå®‰è£… Command Line Toolsï¼‰
- é…ç½®ï¼š`sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer`
- è¿è¡Œï¼š`sudo xcodebuild -runFirstLaunch`

### 7. iOS - Makefile é”™è¯¯

**é”™è¯¯**ï¼š
```
make: rf: No such file or directory
```

**è§£å†³**ï¼šå·²ä¿®å¤ `Makefile` ä¸­çš„ `rf` â†’ `rm -rf` é”™è¯¯ã€‚

### 8. iOS - CocoaPods ç¼–ç é”™è¯¯

**é”™è¯¯**ï¼š
```
Unicode Normalization not appropriate for ASCII-8BIT
```

**è§£å†³**ï¼š
- è®¾ç½®ç¯å¢ƒå˜é‡ï¼š`export LANG=en_US.UTF-8`
- ç„¶åè¿è¡Œï¼š`pod install`

### 9. macOS - CocoaPods ä¾èµ–ç‰ˆæœ¬å†²çª

**é”™è¯¯**ï¼š
```
CocoaPods could not find compatible versions for pod "Sentry/HybridSDK"
```

**è§£å†³**ï¼š
- åˆ é™¤æ—§çš„ Podfile.lockï¼š`rm -f macos/Podfile.lock`
- è®¾ç½®ç¼–ç ï¼š`export LANG=en_US.UTF-8`
- é‡æ–°å®‰è£…ï¼š`cd macos && pod install`

### 10. macOS - CocoaPods ç¼–ç é”™è¯¯

**é”™è¯¯**ï¼š
```
Unicode Normalization not appropriate for ASCII-8BIT
```

**è§£å†³**ï¼š
- è®¾ç½®ç¯å¢ƒå˜é‡ï¼š`export LANG=en_US.UTF-8`
- ç„¶åè¿è¡Œï¼š`cd macos && pod install`

### 11. macOS - æ ¸å¿ƒåº“ä¸‹è½½å¤±è´¥

**é”™è¯¯**ï¼š
```
curl: (22) The requested URL returned error: 404
```

**è§£å†³**ï¼š
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤ `dependencies.properties` ä¸­çš„ `core.version` æ­£ç¡®
- æ£€æŸ¥ `CHANNEL` ç¯å¢ƒå˜é‡ï¼ˆprod æˆ– draftï¼‰

---

## å¿«é€Ÿå‚è€ƒ

### Android å®Œæ•´æ„å»ºæµç¨‹

```bash
# 1. æ£€æŸ¥ AAR æ˜¯å¦å­˜åœ¨
ls android/app/libs/hiddify-core.aar

# 2. å¦‚æœä¸å­˜åœ¨ï¼Œå…ˆç¼–è¯‘ AAR
make build-android-libs

# 3. æ„å»º Flutter APK
flutter clean
flutter build apk --release
```

### iOS å®Œæ•´æ„å»ºæµç¨‹

```bash
# 1. å‡†å¤‡ iOS ç¯å¢ƒï¼ˆé¦–æ¬¡ç¼–è¯‘ï¼‰
make ios-prepare

# 2. æ£€æŸ¥ Framework æ˜¯å¦å­˜åœ¨
ls ios/Frameworks/Libcore.xcframework

# 3. å¦‚æœä¸å­˜åœ¨ï¼Œå…ˆç¼–è¯‘ Framework
make build-ios-libs

# 4. æ„å»º iOS åº”ç”¨
flutter clean
flutter build ios --release --no-codesign
```

### macOS å®Œæ•´æ„å»ºæµç¨‹

```bash
# 1. å‡†å¤‡ macOS ç¯å¢ƒï¼ˆé¦–æ¬¡ç¼–è¯‘ï¼‰
make macos-prepare

# 2. å®‰è£… CocoaPods ä¾èµ–
cd macos
export LANG=en_US.UTF-8
pod install
cd ..

# 3. æ£€æŸ¥æ ¸å¿ƒåº“æ˜¯å¦å­˜åœ¨
ls libcore/bin/libcore.dylib

# 4. å¦‚æœä¸å­˜åœ¨ï¼Œå…ˆä¸‹è½½æ ¸å¿ƒåº“
make macos-libs

# 5. æ„å»º macOS åº”ç”¨
flutter clean
flutter build macos --release
```

### æ›´æ–°ç§æœ‰åº“å¹¶é‡æ–°æ„å»º

```bash
# 1. æ›´æ–°ç§æœ‰åº“
cd libcore
go get github.com/jack9ood/hiddify-sing-box@main
go mod tidy
cd ..

# 2. é‡æ–°ç¼–è¯‘ AAR
make build-android-libs

# 3. é‡æ–°æ„å»º Flutter
flutter clean
flutter build apk --release
```

### åªä¿®æ”¹ Flutter ä»£ç 

```bash
# ç›´æ¥æ„å»ºå³å¯ï¼ˆAAR å·²å­˜åœ¨ï¼‰
flutter clean
flutter build apk --release
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `æ›¿æ¢åº•å±‚åº“æŒ‡å—.md` - æ›¿æ¢åº•å±‚åº“çš„è¯¦ç»†æŒ‡å—ï¼ˆåŒ…å«å…¶ä»– fork çš„ä½¿ç”¨æ–¹æ³•ï¼‰
- `ç¼–è¯‘ç¯å¢ƒ.md` - å®Œæ•´çš„ç¼–è¯‘ç¯å¢ƒé…ç½®è¯´æ˜

---

## âœ… é…ç½®æ€»ç»“

| é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| ç§æœ‰åº“é…ç½® | âœ… å®Œæˆ | `jack9ood/hiddify-sing-box` |
| Go å·¥å…·é“¾ | âœ… é…ç½® | Go 1.22.3 |
| ä¾èµ–æ›´æ–° | âœ… å®Œæˆ | `go mod tidy` |
| ç¼–è¯‘ç¯å¢ƒ | âœ… ä¿®å¤ | Makefile å·²æ›´æ–° |
| Android AAR ç¼–è¯‘ | âœ… å¯ç”¨ | é€šè¿‡ `make build-android-libs` |
| iOS Framework ç¼–è¯‘ | âœ… å¯ç”¨ | é€šè¿‡ `make build-ios-libs` |
| macOS æ ¸å¿ƒåº“ä¸‹è½½ | âœ… å¯ç”¨ | é€šè¿‡ `make macos-libs` |

---

**æç¤º**ï¼šæœ¬æ–‡æ¡£æ•´åˆäº†æ‰€æœ‰é…ç½®å’Œç¼–è¯‘ç›¸å…³çš„ä¿¡æ¯ï¼Œå»ºè®®ä½œä¸ºä¸»è¦å‚è€ƒæ–‡æ¡£ã€‚

**æœ€åæ›´æ–°**ï¼š2024-12-12  
**æ›´æ–°å†…å®¹**ï¼šæ·»åŠ  macOS æ ¸å¿ƒåº“ä¸‹è½½å’Œæ„å»ºè¯´æ˜

