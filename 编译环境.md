# Hiddify App ç¼–è¯‘ç¯å¢ƒé…ç½®æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ç¼–è¯‘ Hiddify App é¡¹ç›®æ‰€éœ€çš„æ‰€æœ‰ç¯å¢ƒé…ç½®å’Œä¾èµ–ã€‚

## ğŸ“‹ ç›®å½•

- [Flutter SDK](#1-flutter-sdk)
- [Android å¼€å‘ç¯å¢ƒ](#2-android-å¼€å‘ç¯å¢ƒ)
- [Java å¼€å‘ç¯å¢ƒ](#3-java-å¼€å‘ç¯å¢ƒ)
- [æ„å»ºå·¥å…·](#4-æ„å»ºå·¥å…·)
- [ä»£ç ç”Ÿæˆå·¥å…·](#5-ä»£ç ç”Ÿæˆå·¥å…·)
- [ç¯å¢ƒéªŒè¯](#6-ç¯å¢ƒéªŒè¯)
- [ç¼–è¯‘æ­¥éª¤](#7-ç¼–è¯‘æ­¥éª¤)
- [å¸¸è§é—®é¢˜](#8-å¸¸è§é—®é¢˜)

---

## 1. Flutter SDK

### ç‰ˆæœ¬è¦æ±‚
- **ä¸¥æ ¼ç‰ˆæœ¬é™åˆ¶**ï¼š`>=3.24.0 <=3.24.3`
- **å½“å‰ä½¿ç”¨ç‰ˆæœ¬**ï¼šFlutter 3.24.3
- **Dart SDK è¦æ±‚**ï¼š`>=3.3.0 <4.0.0`

### å®‰è£…æ­¥éª¤

1. **ä¸‹è½½ Flutter SDK**
   ```bash
   # macOS/Linux
   cd ~/development
   git clone https://github.com/flutter/flutter.git -b stable
   
   # æˆ–ä»å®˜ç½‘ä¸‹è½½ï¼šhttps://flutter.dev/docs/get-started/install
   ```

2. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   # æ·»åŠ åˆ° ~/.zshrc æˆ– ~/.bash_profile
   export PATH="$PATH:$HOME/development/flutter/bin"
   ```

3. **éªŒè¯å®‰è£…**
   ```bash
   flutter --version
   flutter doctor -v
   ```

### é‡è¦æç¤º
âš ï¸ **æœ¬é¡¹ç›®å¯¹ Flutter ç‰ˆæœ¬æœ‰ä¸¥æ ¼é™åˆ¶ï¼Œå¿…é¡»ä½¿ç”¨ 3.24.0-3.24.3 ä¹‹é—´çš„ç‰ˆæœ¬ï¼Œå¦åˆ™å¯èƒ½å‡ºç°å…¼å®¹æ€§é—®é¢˜ã€‚**

---

## 2. Android å¼€å‘ç¯å¢ƒ

### 2.1 Android SDK

#### å¿…éœ€å®‰è£…çš„ç»„ä»¶

| ç»„ä»¶ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Android SDK Platform | **35** | å¿…éœ€ï¼Œé¡¹ç›® compileSdk |
| Android SDK Build-Tools | **34.0.0** | å¿…éœ€ï¼Œéƒ¨åˆ†æ’ä»¶ä¾èµ– |
| Android SDK Build-Tools | **36.1.0** | å¿…éœ€ï¼Œé¡¹ç›®é…ç½®ä½¿ç”¨ |
| Android NDK | **27.0.12077973** | å¿…éœ€ï¼Œå¤šä¸ªæ’ä»¶ä¾èµ– |

#### å®‰è£…æ–¹æ³•

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Android Studioï¼ˆæ¨èï¼‰**

1. æ‰“å¼€ Android Studio
2. è¿›å…¥ `Tools` â†’ `SDK Manager`
3. åˆ‡æ¢åˆ° `SDK Platforms` æ ‡ç­¾
   - å‹¾é€‰ `Android 15.0 (API 35)` å¹¶å®‰è£…
4. åˆ‡æ¢åˆ° `SDK Tools` æ ‡ç­¾
   - å‹¾é€‰ `Show Package Details`
   - å±•å¼€ `Android SDK Build-Tools`
     - å‹¾é€‰ `34.0.0` å¹¶å®‰è£…
     - å‹¾é€‰ `36.1.0` å¹¶å®‰è£…
   - å±•å¼€ `NDK (Side by side)`
     - å‹¾é€‰ `27.0.12077973` å¹¶å®‰è£…

**æ–¹æ³•äºŒï¼šä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·**

```bash
# è®¾ç½® Java ç¯å¢ƒï¼ˆä½¿ç”¨ Android Studio çš„ JBRï¼‰
export JAVA_HOME=/Applications/Android\ Studio.app/Contents/jbr/Contents/Home

# å®‰è£… Android SDK Platform 35
sdkmanager "platforms;android-35"

# å®‰è£… Build Tools
sdkmanager "build-tools;34.0.0"
sdkmanager "build-tools;36.1.0"

# å®‰è£… NDK
sdkmanager "ndk;27.0.12077973"
```

#### ç¯å¢ƒå˜é‡é…ç½®

```bash
# macOS/Linux
export ANDROID_HOME=$HOME/Library/Android/sdk
export PATH=$PATH:$ANDROID_HOME/platform-tools
export PATH=$PATH:$ANDROID_HOME/tools
export PATH=$PATH:$ANDROID_HOME/tools/bin
```

### 2.2 éªŒè¯ Android SDK å®‰è£…

```bash
# æ£€æŸ¥ Platform 35
ls $ANDROID_HOME/platforms/android-35

# æ£€æŸ¥ Build Tools
ls $ANDROID_HOME/build-tools/34.0.0
ls $ANDROID_HOME/build-tools/36.1.0

# æ£€æŸ¥ NDK
ls $ANDROID_HOME/ndk/27.0.12077973

# æ¥å—æ‰€æœ‰ Android è®¸å¯è¯
flutter doctor --android-licenses
```

---

## 3. Java å¼€å‘ç¯å¢ƒ

### ç‰ˆæœ¬è¦æ±‚
- **é¡¹ç›®è¦æ±‚**ï¼šJava 17ï¼ˆå¿…éœ€ï¼‰
- **å…¼å®¹ç‰ˆæœ¬**ï¼šJava 21ï¼ˆå‘åå…¼å®¹ï¼Œå¯ä»¥ä½¿ç”¨ï¼‰

### é…ç½®è¯´æ˜

é¡¹ç›®é…ç½®ï¼š
- `sourceCompatibility = JavaVersion.VERSION_17`
- `targetCompatibility = JavaVersion.VERSION_17`
- `kotlinOptions.jvmTarget = '17'`

### æ¨èä½¿ç”¨ Android Studio JBR

Android Studio è‡ªå¸¦çš„ JBRï¼ˆJetBrains Runtimeï¼‰å·²åŒ…å« Javaï¼Œæ¨èä½¿ç”¨ï¼š

```bash
# macOS
export JAVA_HOME=/Applications/Android\ Studio.app/Contents/jbr/Contents/Home

# Linux
export JAVA_HOME=/opt/android-studio/jbr

# Windows
set JAVA_HOME=C:\Program Files\Android\Android Studio\jbr
```

### éªŒè¯ Java å®‰è£…

```bash
java -version
# åº”è¯¥æ˜¾ç¤º 17 æˆ– 21

echo $JAVA_HOME
# åº”è¯¥æ˜¾ç¤ºæ­£ç¡®çš„ Java è·¯å¾„
```

---

## 4. æ„å»ºå·¥å…·

### 4.1 Android Gradle Plugin (AGP)

- **ç‰ˆæœ¬**ï¼š8.7.3
- **é…ç½®æ–‡ä»¶**ï¼š`android/settings.gradle`

```gradle
plugins {
    id "com.android.application" version "8.7.3" apply false
}
```

### 4.2 Gradle

- **ç‰ˆæœ¬**ï¼š8.9ï¼ˆAGP 8.7.3 è¦æ±‚çš„æœ€ä½ç‰ˆæœ¬ï¼‰
- **é…ç½®æ–‡ä»¶**ï¼š`android/gradle/wrapper/gradle-wrapper.properties`

```properties
distributionUrl=https\://services.gradle.org/distributions/gradle-8.9-all.zip
```

### 4.3 Kotlin

- **ç‰ˆæœ¬**ï¼š1.8.21
- **é…ç½®æ–‡ä»¶**ï¼š`android/settings.gradle`

```gradle
id "org.jetbrains.kotlin.android" version "1.8.21" apply false
```

---

## 5. ä»£ç ç”Ÿæˆå·¥å…·

é¡¹ç›®ä½¿ç”¨å¤šä¸ªä»£ç ç”Ÿæˆå·¥å…·ï¼Œè¿™äº›ä¼šåœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨è¿è¡Œï¼š

| å·¥å…· | ç”¨é€” |
|------|------|
| `build_runner` | é€šç”¨ä»£ç ç”Ÿæˆ |
| `drift_dev` | æ•°æ®åº“ä»£ç ç”Ÿæˆ |
| `slang_build_runner` | å›½é™…åŒ–ä»£ç ç”Ÿæˆ |
| `freezed` | ä¸å¯å˜ç±»ç”Ÿæˆ |
| `riverpod_generator` | çŠ¶æ€ç®¡ç†ä»£ç ç”Ÿæˆ |
| `json_serializable` | JSON åºåˆ—åŒ–ä»£ç ç”Ÿæˆ |

### æ‰‹åŠ¨è¿è¡Œä»£ç ç”Ÿæˆ

```bash
flutter pub run build_runner build --delete-conflicting-outputs
```

---

## 6. ç¯å¢ƒéªŒè¯

### å¿«é€Ÿæ£€æŸ¥è„šæœ¬

```bash
#!/bin/bash

echo "=== æ£€æŸ¥ Flutter ==="
flutter --version
echo ""

echo "=== æ£€æŸ¥ Android SDK ==="
echo "ANDROID_HOME: $ANDROID_HOME"
ls -d $ANDROID_HOME/platforms/android-35 2>/dev/null && echo "âœ“ Platform 35 å·²å®‰è£…" || echo "âœ— Platform 35 æœªå®‰è£…"
ls -d $ANDROID_HOME/build-tools/34.0.0 2>/dev/null && echo "âœ“ Build Tools 34.0.0 å·²å®‰è£…" || echo "âœ— Build Tools 34.0.0 æœªå®‰è£…"
ls -d $ANDROID_HOME/build-tools/36.1.0 2>/dev/null && echo "âœ“ Build Tools 36.1.0 å·²å®‰è£…" || echo "âœ— Build Tools 36.1.0 æœªå®‰è£…"
ls -d $ANDROID_HOME/ndk/27.0.12077973 2>/dev/null && echo "âœ“ NDK 27.0.12077973 å·²å®‰è£…" || echo "âœ— NDK 27.0.12077973 æœªå®‰è£…"
echo ""

echo "=== æ£€æŸ¥ Java ==="
java -version
echo "JAVA_HOME: $JAVA_HOME"
echo ""

echo "=== æ£€æŸ¥ Gradle ==="
cd android && ./gradlew --version
cd ..
echo ""

echo "=== Flutter Doctor ==="
flutter doctor -v
```

### ä½¿ç”¨ Flutter Doctor

```bash
flutter doctor -v
```

ç¡®ä¿æ‰€æœ‰å¿…éœ€é¡¹éƒ½æ˜¾ç¤º âœ“ï¼Œç‰¹åˆ«æ³¨æ„ï¼š
- âœ“ Flutter (ç‰ˆæœ¬ 3.24.0-3.24.3)
- âœ“ Android toolchain
- âœ“ Android licenses accepted

---

## 7. ç¼–è¯‘æ­¥éª¤

### å®Œæ•´ç¼–è¯‘æµç¨‹

```bash
# 1. å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git clone <repository-url>
cd hiddify-app

# 2. å®‰è£… Flutter ä¾èµ–
flutter pub get

# 3. ç”Ÿæˆä»£ç ï¼ˆå¯é€‰ï¼Œç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨è¿è¡Œï¼‰
flutter pub run build_runner build --delete-conflicting-outputs

# 4. ç¼–è¯‘ Release APK
flutter build apk --release

# 5. æŸ¥æ‰¾ç”Ÿæˆçš„ APK
# é€šç”¨ APKï¼ˆæ¨èï¼‰ï¼š
# build/app/outputs/flutter-apk/app-release.apk

# åˆ†æ¶æ„ APKï¼š
# build/app/outputs/flutter-apk/app-arm64-v8a-release.apk
# build/app/outputs/flutter-apk/app-armeabi-v7a-release.apk
# build/app/outputs/flutter-apk/app-x86_64-release.apk
```

### ç¼–è¯‘é€‰é¡¹

```bash
# Release ç‰ˆæœ¬ï¼ˆç”¨äºå‘å¸ƒï¼‰
flutter build apk --release

# Debug ç‰ˆæœ¬ï¼ˆç”¨äºæµ‹è¯•ï¼‰
flutter build apk --debug

# ä»…ç¼–è¯‘ç‰¹å®šæ¶æ„ï¼ˆå‡å° APK å¤§å°ï¼‰
flutter build apk --release --target-platform android-arm64

# æ¸…ç†æ„å»ºç¼“å­˜
flutter clean
```

---

## 8. å¸¸è§é—®é¢˜

### 8.1 Flutter ç‰ˆæœ¬ä¸å…¼å®¹

**é”™è¯¯ä¿¡æ¯**ï¼š
```
This project requires a higher version of Flutter SDK
```

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥ Flutter ç‰ˆæœ¬ï¼š`flutter --version`
- åˆ‡æ¢åˆ°æ­£ç¡®çš„ç‰ˆæœ¬ï¼š`flutter version 3.24.3`

### 8.2 Android SDK Platform 35 æœªæ‰¾åˆ°

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Failed to find Platform SDK with path: platforms;android-35
```

**è§£å†³æ–¹æ³•**ï¼š
- ä½¿ç”¨ Android Studio SDK Manager å®‰è£… Platform 35
- æˆ–ä½¿ç”¨å‘½ä»¤è¡Œï¼š`sdkmanager "platforms;android-35"`

### 8.3 Build Tools ç‰ˆæœ¬é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Failed to find Build Tools revision 34.0.0
```

**è§£å†³æ–¹æ³•**ï¼š
- å®‰è£… Build Tools 34.0.0ï¼š`sdkmanager "build-tools;34.0.0"`
- ç¡®ä¿é¡¹ç›®é…ç½®ä¸­çš„ buildToolsVersion æ­£ç¡®

### 8.4 NDK ç‰ˆæœ¬ä¸åŒ¹é…

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Your project is configured with Android NDK 26.1.10909125, but plugin requires 27.0.12077973
```

**è§£å†³æ–¹æ³•**ï¼š
- å®‰è£… NDK 27.0.12077973ï¼š`sdkmanager "ndk;27.0.12077973"`
- æ›´æ–° `android/app/build.gradle` ä¸­çš„ `ndkVersion`

### 8.5 Java ç‰ˆæœ¬é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Unsupported class file major version
```

**è§£å†³æ–¹æ³•**ï¼š
- ç¡®ä¿ä½¿ç”¨ Java 17 æˆ– 21
- æ£€æŸ¥ JAVA_HOME ç¯å¢ƒå˜é‡
- ä½¿ç”¨ Android Studio çš„ JBRï¼ˆæ¨èï¼‰

### 8.6 dynamic_color å…¼å®¹æ€§é—®é¢˜

**é”™è¯¯ä¿¡æ¯**ï¼š
```
The method 'toARGB32' isn't defined for the class 'Color'
```

**è§£å†³æ–¹æ³•**ï¼š
- é”å®š `dynamic_color` ç‰ˆæœ¬ä¸º 1.7.0
- åœ¨ `pubspec.yaml` ä¸­ä½¿ç”¨ï¼š`dynamic_color: 1.7.0`ï¼ˆä¸è¦ä½¿ç”¨ `^`ï¼‰

### 8.7 flutter_easy_permission namespace é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Namespace not specified. Specify a namespace in the module's build file.
```

**è§£å†³æ–¹æ³•**ï¼š
- ç¼–è¾‘ `~/.pub-cache/git/flutter_easy_permission-*/android/build.gradle`
- æ·»åŠ ï¼š`namespace "xyz.bczl.flutter.easy_permission"`

### 8.8 Kotlin ç©ºå®‰å…¨æ£€æŸ¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Only safe (?.) or non-null asserted (!!.) calls are allowed on a nullable receiver
```

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥ Kotlin ä»£ç ä¸­çš„ç©ºå®‰å…¨è°ƒç”¨
- ä½¿ç”¨ `?.` æˆ– `!!.` å¤„ç†å¯ç©ºç±»å‹
- æˆ–æ·»åŠ ç©ºå€¼æ£€æŸ¥

---

## 9. é¡¹ç›®é…ç½®æ€»ç»“

### å…³é”®é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | å…³é”®é…ç½® |
|------|----------|
| `pubspec.yaml` | Flutter SDK: >=3.24.0 <=3.24.3<br>Dart SDK: >=3.3.0 <4.0.0<br>dynamic_color: 1.7.0 |
| `android/app/build.gradle` | compileSdkVersion: 35<br>targetSdkVersion: 35<br>buildToolsVersion: 36.1.0<br>ndkVersion: 27.0.12077973<br>Java: 17 |
| `android/settings.gradle` | AGP: 8.7.3<br>Kotlin: 1.8.21 |
| `android/gradle/wrapper/gradle-wrapper.properties` | Gradle: 8.9 |

### ç‰¹æ®Šä¾èµ–è¯´æ˜

1. **flutter_easy_permission**
   - æ¥æºï¼šGit ä»“åº“
   - éœ€è¦æ‰‹åŠ¨æ·»åŠ  namespace é…ç½®

2. **dynamic_color**
   - å¿…é¡»é”å®šä¸º 1.7.0
   - 1.8.1 ç‰ˆæœ¬ä¸ Flutter 3.24.3 ä¸å…¼å®¹

---

## 10. å‘å¸ƒé…ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚éœ€å‘å¸ƒ APK åˆ° Google Playï¼Œéœ€è¦é…ç½®ç­¾åï¼š

### åˆ›å»º keystore

```bash
keytool -genkey -v -keystore ~/upload-keystore.jks \
  -keyalg RSA -keysize 2048 -validity 10000 \
  -alias upload
```

### é…ç½®ç­¾å

åˆ›å»º `android/key.properties` æ–‡ä»¶ï¼š

```properties
storePassword=<your-store-password>
keyPassword=<your-key-password>
keyAlias=upload
storeFile=/path/to/upload-keystore.jks
```

### å®‰å…¨æç¤º

âš ï¸ **ä¸è¦å°† `key.properties` å’Œ keystore æ–‡ä»¶æäº¤åˆ° Git ä»“åº“ï¼**

åœ¨ `.gitignore` ä¸­æ·»åŠ ï¼š
```
android/key.properties
*.jks
*.keystore
```

---

## 11. å‚è€ƒèµ„æ–™

- [Flutter å®˜æ–¹æ–‡æ¡£](https://flutter.dev/docs)
- [Android å¼€å‘è€…æ–‡æ¡£](https://developer.android.com/)
- [Gradle ç”¨æˆ·æŒ‡å—](https://docs.gradle.org/)
- [é¡¹ç›® GitHub ä»“åº“](https://github.com/hiddify/hiddify-app)

---

## 12. æ›´æ–°æ—¥å¿—

- **2024-12-10**ï¼šåˆå§‹æ–‡æ¡£åˆ›å»º
  - è®°å½•å®Œæ•´çš„ç¼–è¯‘ç¯å¢ƒé…ç½®
  - æ·»åŠ å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ
  - åŒ…å«æ‰€æœ‰å¿…éœ€çš„ç‰ˆæœ¬ä¿¡æ¯

---

**æœ€åæ›´æ–°**ï¼š2024-12-10  
**ç»´æŠ¤è€…**ï¼šHiddify å¼€å‘å›¢é˜Ÿ

